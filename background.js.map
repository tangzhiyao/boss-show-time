{"version":3,"file":"background.js","mappings":"mBAAO,MAAMA,EAAiB,iBACjBC,EAAa,aACbC,EAAY,YCIzB,MAAMC,EAAY,IAAMC,YAAYC,OAAOC,QAAQC,gBAAiB,KASpE,IAAIC,EARJH,OAAOC,QAAQG,UAAUC,YAAYP,GACrCA,IAGAE,OAAOC,QAAQK,YAAYD,aAAY,KACrCL,OAAOO,UAAUC,iBAAiB,CAAEC,wBAAwB,GAAO,IAIrEC,eAAsCC,SAG1BX,OAAOY,UAAUC,mBAGvBV,QACIA,GAENA,EAAWH,OAAOY,UAAUE,eAAe,CACzCC,IAAKf,OAAOC,QAAQe,OA4FH,kBA3FjBC,QAAS,CACPjB,OAAOY,UAAUM,OAAOC,SAAWnB,OAAOY,UAAUM,OAAOE,OAE7DC,cAAe,0CAEXlB,EACNA,EAAW,MAGbH,OAAOC,QAAQqB,UAAUjB,aAAYK,eACnCa,EACAC,EACAC,GAEIF,IACEA,EAAQG,MAAQ/B,GAAkB4B,EAAQI,IAAM/B,GAE9C4B,EAAOI,MACTL,EAAQM,MAAQL,EAAOI,IAAIE,IAIzBP,EAAQG,KAERH,EAAQI,GAERJ,EAAQQ,OAERR,EAAQS,WAERT,EAAQU,MAGZV,EAAQG,KAAO9B,EACf2B,EAAQI,GAAK9B,EAGT0B,EAAQG,KAERH,EAAQI,GAERJ,EAAQQ,OAERR,EAAQS,WAERT,EAAQU,MAGZjC,OAAOC,QAAQiC,YAAYX,IAClBA,EAAQG,MAAQ7B,GAAa0B,EAAQI,IAAM/B,IAGhD2B,EAAQG,KAERH,EAAQI,GAERJ,EAAQQ,OAERR,EAAQS,WAERT,EAAQU,MAGZV,EAAQG,KAAO9B,EACf2B,EAAQI,GAAKhC,EAGT4B,EAAQG,KAERH,EAAQI,GAERJ,EAAQQ,OAERR,EAAQS,WAERT,EAAQU,MAGRV,EAAQM,MAEV7B,OAAOmC,KAAKD,YAAYX,EAAQM,MAAON,GAIvCvB,OAAOC,QAAQiC,YAAYX,IAInC,IACF,CAEAa,E","sources":["webpack://boss-show-time/./src/api/bridgeCommon.js","webpack://boss-show-time/./src/background.js"],"sourcesContent":["export const CONTENT_SCRIPT = \"CONTENT_SCRIPT\";\nexport const BACKGROUND = \"BACKGROUND\";\nexport const OFFSCREEN = \"OFFSCREEN\";\nexport const WEB_WORKER = \"WEB_WORKER\";\n","import { BACKGROUND, CONTENT_SCRIPT, OFFSCREEN } from \"./api/bridgeCommon\";\nimport { debugLog, infoLog } from \"./log\";\n\ndebugLog(\"background ready\");\ndebugLog(\"keepAlive start\");\n//see https://stackoverflow.com/questions/66618136/persistent-service-worker-in-chrome-extension\nconst keepAlive = () => setInterval(chrome.runtime.getPlatformInfo, 20e3);\nchrome.runtime.onStartup.addListener(keepAlive);\nkeepAlive();\n\n//sidepanel\nchrome.runtime.onInstalled.addListener(() => {\n  chrome.sidePanel.setPanelBehavior({ openPanelOnActionClick: true });\n});\n\nlet creating;\nasync function setupOffscreenDocument(path) {\n  // Check all windows controlled by the service worker to see if one\n  // of them is the offscreen document with the given path\n  if (await chrome.offscreen.hasDocument?.()) return;\n\n  // create offscreen document\n  if (creating) {\n    await creating;\n  } else {\n    creating = chrome.offscreen.createDocument({\n      url: chrome.runtime.getURL(path),\n      reasons: [\n        chrome.offscreen.Reason.WORKERS || chrome.offscreen.Reason.BLOBS,\n      ],\n      justification: \"To run web worker to run sqlite\",\n    });\n    await creating;\n    creating = null;\n  }\n\n  chrome.runtime.onMessage.addListener(async function (\n    message,\n    sender,\n    sendResponse\n  ) {\n    if (message) {\n      if (message.from == CONTENT_SCRIPT && message.to == BACKGROUND) {\n        //get the tab id from content script page,not the extension page(eg: sidepanel)\n        if (sender.tab) {\n          message.tabId = sender.tab.id;\n        }\n        debugLog(\n          \"2.[background][receive][\" +\n            message.from +\n            \" -> \" +\n            message.to +\n            \"] message [action=\" +\n            message.action +\n            \",callbackId=\" +\n            message.callbackId +\n            \",error=\" +\n            message.error +\n            \"]\"\n        );\n        message.from = BACKGROUND;\n        message.to = OFFSCREEN;\n        debugLog(\n          \"3.[background][send][\" +\n            message.from +\n            \" -> \" +\n            message.to +\n            \"] message [action=\" +\n            message.action +\n            \",callbackId=\" +\n            message.callbackId +\n            \",error=\" +\n            message.error +\n            \"]\"\n        );\n        chrome.runtime.sendMessage(message);\n      } else if (message.from == OFFSCREEN && message.to == BACKGROUND) {\n        debugLog(\n          \"10.[background][receive][\" +\n            message.from +\n            \" -> \" +\n            message.to +\n            \"] message [action=\" +\n            message.action +\n            \",callbackId=\" +\n            message.callbackId +\n            \",error=\" +\n            message.error +\n            \"]\"\n        );\n        message.from = BACKGROUND;\n        message.to = CONTENT_SCRIPT;\n        debugLog(\n          \"11.[background][send][\" +\n            message.from +\n            \" -> \" +\n            message.to +\n            \"] message [action=\" +\n            message.action +\n            \",callbackId=\" +\n            message.callbackId +\n            \",error=\" +\n            message.error +\n            \"]\"\n        );\n        if (message.tabId) {\n          //content script invoke\n          chrome.tabs.sendMessage(message.tabId, message);\n        } else {\n          //other invoke\n          //Note that extensions cannot send messages to content scripts using this method. To send messages to content scripts, use tabs.sendMessage.\n          chrome.runtime.sendMessage(message);\n        }\n      }\n    }\n  });\n}\n\nsetupOffscreenDocument(\"offscreen.html\");\n"],"names":["CONTENT_SCRIPT","BACKGROUND","OFFSCREEN","keepAlive","setInterval","chrome","runtime","getPlatformInfo","creating","onStartup","addListener","onInstalled","sidePanel","setPanelBehavior","openPanelOnActionClick","async","path","offscreen","hasDocument","createDocument","url","getURL","reasons","Reason","WORKERS","BLOBS","justification","onMessage","message","sender","sendResponse","from","to","tab","tabId","id","action","callbackId","error","sendMessage","tabs","setupOffscreenDocument"],"sourceRoot":""}